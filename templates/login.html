{% extends "base_public.html" %}

{% block title %}{{ settings.site_title }}{% endblock %}

{% block navbar %}
{% include 'includes/navbar_landing.html' %}
{% endblock %}

{% block content %}
<div class="container">
    <section class="hero-section">
        <div class="hero-date" id="heroDate"><i class="far fa-calendar-alt"></i> <span>--</span></div>
        <h1 class="hero-title">{{ settings.site_title.split()[0] }} <span>{{ ' '.join(settings.site_title.split()[1:])
                }}</span></h1>
        <p class="hero-subtitle">{{ settings.site_subtitle }}</p>
    </section>

    <div class="widgets-grid">
        {% if settings.show_currency %}
        <div class="widget">
            <div class="widget-header">
                <span class="widget-title">DÃ¶viz KurlarÄ± (CanlÄ±)</span>
                <div class="widget-icon"><i class="fas fa-coins"></i></div>
            </div>
            <div class="currency-list" id="currencyList">
                <div class="currency-item">
                    <div class="currency-name">
                        <div class="currency-flag">ðŸ‡ºðŸ‡¸</div><span class="currency-code">USD/TRY</span>
                    </div>
                    <div style="text-align: right;">
                        <div class="currency-rate" id="usdRate"><span class="rate-loading">YÃ¼kleniyor...</span>
                        </div>
                    </div>
                </div>
                <div class="currency-item">
                    <div class="currency-name">
                        <div class="currency-flag">ðŸ‡ªðŸ‡º</div><span class="currency-code">EUR/TRY</span>
                    </div>
                    <div style="text-align: right;">
                        <div class="currency-rate" id="eurRate"><span class="rate-loading">YÃ¼kleniyor...</span>
                        </div>
                    </div>
                </div>
                <div class="currency-item">
                    <div class="currency-name">
                        <div class="currency-flag">ðŸ‡¬ðŸ‡§</div><span class="currency-code">GBP/TRY</span>
                    </div>
                    <div style="text-align: right;">
                        <div class="currency-rate" id="gbpRate"><span class="rate-loading">YÃ¼kleniyor...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if settings.show_clock %}
        <div class="widget">
            <div class="widget-header">
                <span class="widget-title">TÃ¼rkiye Saati</span>
                <div class="widget-icon"><i class="fas fa-clock"></i></div>
            </div>
            <div class="clock-display"><span id="clockTime">--:--</span><span class="clock-seconds"
                    id="clockSeconds">:--</span></div>
            <div class="clock-date" id="clockDate">--</div>
        </div>
        {% endif %}

        <div class="widget">
            <div class="widget-header">
                <span class="widget-title">Sistem Durumu</span>
                <div class="widget-icon"><i class="fas fa-server"></i></div>
            </div>
            <div class="status-item">
                <span class="status-label">API Server</span>
                <span class="status-value"><span class="status-dot online"></span> Aktif</span>
            </div>
            <div class="status-item">
                <span class="status-label">Gateway</span>
                <span class="status-value"><span class="status-dot online"></span> Aktif</span>
            </div>
            <div class="status-item">
                <span class="status-label">Uptime</span>
                <span class="status-value">99.9%</span>
            </div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <span class="widget-title">HÄ±zlÄ± Bilgi</span>
                <div class="widget-icon"><i class="fas fa-info-circle"></i></div>
            </div>
            <div class="status-item">
                <span class="status-label">Versiyon</span>
                <span class="status-value">1.0.0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Sunucu</span>
                <span class="status-value">Vultr EU</span>
            </div>
            <div class="status-item">
                <span class="status-label">Framework</span>
                <span class="status-value">Flask</span>
            </div>
        </div>
    </div>

    <h3 class="section-title"><i class="fas fa-th-large"></i> HÄ±zlÄ± EriÅŸim</h3>
    <div class="quick-links">
        {% for module in settings.modules %}{% if module.enabled %}
        <a href="{{ module.url }}" class="quick-link">
            <div class="quick-link-icon"><i class="fas {{ module.icon }}"></i></div>
            <span class="quick-link-title">{{ module.name }}</span>
            <span class="quick-link-badge {{ module.status }}">{% if module.status == 'active' %}Aktif{% elif
                module.status == 'dev' %}GeliÅŸtiriliyor{% else %}YakÄ±nda{% endif %}</span>
        </a>
        {% endif %}{% endfor %}
    </div>
</div>

<div class="modal-overlay" id="loginModal">
    <div class="login-modal">
        <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
        <div class="login-header">
            <div class="login-icon"><i class="fas fa-lock"></i></div>
            <div class="login-title">YÃ¶netici GiriÅŸi</div>
            <div class="login-subtitle">Devam etmek iÃ§in giriÅŸ yapÄ±n</div>
        </div>
        {% if error %}<div class="error-msg"><i class="fas fa-exclamation-circle"></i> {{ error }}</div>{% endif %}
        <form method="POST" action="/login">
            <div class="form-group"><label class="form-label">KullanÄ±cÄ± AdÄ±</label><input type="text" name="username"
                    class="form-input" placeholder="admin" required></div>
            <div class="form-group"><label class="form-label">Åžifre</label><input type="password" name="password"
                    class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required></div>
            <button type="submit" class="login-btn"><i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0'), m = String(now.getMinutes()).padStart(2, '0'), s = String(now.getSeconds()).padStart(2, '0');
        const clockTime = document.getElementById('clockTime');
        const clockSeconds = document.getElementById('clockSeconds');
        const clockDate = document.getElementById('clockDate');
        const heroDate = document.querySelector('#heroDate span');

        if (clockTime) clockTime.textContent = `${h}:${m}`;
        if (clockSeconds) clockSeconds.textContent = `:${s}`;

        const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const dateStr = now.toLocaleDateString('tr-TR', opts);

        if (clockDate) clockDate.textContent = dateStr;
        if (heroDate) heroDate.textContent = dateStr.toUpperCase();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function openModal() { document.getElementById('loginModal').classList.add('active'); }
    function closeModal() { document.getElementById('loginModal').classList.remove('active'); }
    document.getElementById('loginModal').addEventListener('click', e => { if (e.target === document.getElementById('loginModal')) closeModal(); });
    {% if error %} openModal(); {% endif %}

    // Fetch LIVE currency rates
    async function fetchRates() {
        if (!document.getElementById('currencyList')) return;
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            const data = await res.json();
            const tryRate = data.rates.TRY;
            document.getElementById('usdRate').textContent = tryRate.toFixed(2) + ' â‚º';
            document.getElementById('eurRate').textContent = (tryRate / data.rates.EUR).toFixed(2) + ' â‚º';
            document.getElementById('gbpRate').textContent = (tryRate / data.rates.GBP).toFixed(2) + ' â‚º';
        } catch (e) {
            if (document.getElementById('usdRate')) {
                document.getElementById('usdRate').textContent = 'Hata';
                document.getElementById('eurRate').textContent = 'Hata';
                document.getElementById('gbpRate').textContent = 'Hata';
            }
        }
    }
    fetchRates();
    setInterval(fetchRates, 60000); 
</script>
{% endblock %}